<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Offside Verse</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />

<!-- Shaka Player -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/shaka-player/4.7.6/controls.min.css" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/shaka-player/4.7.6/shaka-player.ui.min.js" crossorigin="anonymous"></script>

<!-- Disable DevTools -->
<script disable-devtool-auto src="https://cdn.jsdelivr.net/npm/disable-devtool"></script>

<style>
:root{
  --blue1:#0b3b8c;
  --blue2:#072b6a;
  --bg:#0a1733;
  --text:#ffffff;
  --border:rgba(255,255,255,.15);
  --shadow:rgba(0,0,0,.35);
}

*{box-sizing:border-box}

body{
  margin:0;
  font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;
  background:var(--bg);
  color:var(--text);
}

.bar{
  max-width:980px;
  margin:14px auto;
  padding:0 12px;
}

.pill{
  background:linear-gradient(90deg,var(--blue1),var(--blue2));
  text-align:center;
  padding:14px;
  border-radius:14px;
  font-weight:800;
  box-shadow:0 8px 20px var(--shadow);
  border:1px solid var(--border);
}

/* VIDEO */
.panel{
  margin:14px 0;
  background:#000;
  border-radius:10px;
  overflow:hidden;
  border:3px solid rgba(30,120,255,.25);
  box-shadow:0 10px 26px var(--shadow);
}

.shaka-video{
  width:100%;
  aspect-ratio:16/9;
  background:#000;
}

/* BUTTONS */
.btn{
  display:inline-flex;
  align-items:center;
  gap:10px;
  padding:12px 22px;
  border-radius:14px;
  font-weight:700;
  color:#fff;
  text-decoration:none;
  background:transparent;
  border:2px solid rgba(255,255,255,.85);
  cursor:pointer;
}

.btn img{
  width:20px;
  height:20px;
}

.btn:active{
  transform:translateY(1px);
}

.row{
  display:flex;
  justify-content:center;
}

/* ===== DUAL SECTIONS (LIKE IMAGE) ===== */
.dual-sections{
  display:flex;
  gap:20px;
  margin:16px 0;
}

.section{
  flex:1;
  background:linear-gradient(90deg,var(--blue1),var(--blue2));
  border-radius:18px;
  padding:22px;
  text-align:center;
  box-shadow:0 8px 20px var(--shadow);
  border:1px solid var(--border);
}

.section h3{
  margin:0 0 16px;
  font-size:18px;
  font-weight:800;
}

/* Mobile */
@media(max-width:768px){
  .dual-sections{
    flex-direction:column;
  }
}
</style>
</head>

<body>

<div class="bar">

  <div class="pill">Offside Verse</div>

  <div class="panel">
    <video id="video"
      class="shaka-video"
      data-shaka-player
      autoplay
      muted
      playsinline
      poster="https://ik.imagekit.io/offsideverse/ChatGPT%20Image%20Feb%206,%202026,%2008_57_27%20AM.png">
    </video>
  </div>

  <!-- SIDE BY SIDE SECTIONS -->
  <div class="dual-sections">

    <!-- TELEGRAM -->
    <div class="section">
      <h3>üì£ Follow us for Updates!</h3>
      <div class="row">
        <a class="btn"
           href="https://t.me/+7VkflslOE9s4YjQ9"
           target="_blank"
           rel="noopener">
          <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/8/82/Telegram_logo.svg/768px-Telegram_logo.svg.png">
          Click Here To Join Telegram For More Links
        </a>
      </div>
    </div>

    <!-- SHARE -->
    <div class="section">
      <h3>Copy Link & Open in Chrome Browser Only</h3>
      <div class="row">
        <button class="btn"
          onclick="navigator.share ? navigator.share({url: location.href}) : alert(location.href)">
          Click Here To Share This Page Link ‚ù§Ô∏è
        </button>
      </div>
    </div>

  </div>

</div>

<script>
    // Global variables
    let currentPlayer = null;
    let jwplayerInstance = null;
    let shakaPlayer = null;
    let shakaUI = null;
    let currentChannel = null;
    let allChannels = [];
    let popupShown = false;
    let confirmShown = false;
  // Get URL parameter
    function getUrlParameter(name) {
      const urlParams = new URLSearchParams(window.location.search);
      return urlParams.get(name);
    }
  // Fetch channels from JSON - NO LOADING INDICATOR
    async function fetchChannels() {
      try {
        const url = ${https://offsidejson.vercel.app/channel.json}?t=${Date.now()};
        const response = await fetch(url);
        
        if (!response.ok) {
          throw new Error(Failed to fetch: ${response.status} ${response.statusText});
        }
        
        const text = await response.text();
        
        let data;
        try {
          data = JSON.parse(text);
        } catch (parseError) {
          // Try to fix JSON
          let fixedText = text
            .replace(/,\s*}/g, '}')
            .replace(/,\s*]/g, ']')
            .replace(/"keys":\s*{\s*"":\s*""\s*}/g, '"keys": {}')
            .replace(/"keys":\s*{\s*"":\s*""\s*,?\s*}/g, '"keys": {}')
            .replace(/\/\/.*$/gm, '');
          
          try {
            data = JSON.parse(fixedText);
          } catch (e) {
            throw new Error(Invalid JSON: ${parseError.message});
          }
        }
        
        // Parse data structure
        if (Array.isArray(data)) {
          allChannels = data;
        } else if (data && typeof data === 'object') {
          if (Array.isArray(data.channels)) {
            allChannels = data.channels;
          } else if (data.id && data.url) {
            allChannels = [data];
          }
        }
        
        if (!allChannels  allChannels.length === 0) {
          throw new Error('No channels found in JSON');
        }
        
        // Clean channel data
        allChannels = allChannels.map(ch => ({
          id: ch.id  'channel_' + Math.random().toString(36).substr(2, 9),
          name: ch.name  ch.id  'Unknown',
          type: (ch.type  'mpd').toLowerCase(),
          url: ch.url,
          keys: ch.keys  {},
          poster: ch.poster  ''
        }));
        
        return allChannels;
        
      } catch (error) {
        console.error('Fetch error:', error);
        throw error;
      }
    }

    // Find channel by ID
    function findChannelById(channelId) {
      if (!channelId  !allChannels.length) return null;
      
      // Try exact match
      let channel = allChannels.find(ch => ch.id === channelId);
      
      // Try case-insensitive
      if (!channel) {
        channel = allChannels.find(ch => 
          ch.id.toLowerCase() === channelId.toLowerCase() ||
          ch.name.toLowerCase() === channelId.toLowerCase()
        );
      }
      
      return channel;
    }

    // Initialize Shaka Player - SIMPLIFIED
    async function initShakaPlayer() {
      if (typeof shaka === 'undefined') {
        throw new Error('Shaka Player not loaded');
      }
      
      shaka.polyfill.installAll();
      
      if (!shaka.Player.isBrowserSupported()) {
        throw new Error('Browser not supported by Shaka Player');
      }
      
      return true;
    }
  // Load MPD channel with Shaka Player - NO LOADING
    async function loadMpdChannel(channel) {
      console.log('Loading MPD channel:', channel);
      
      try {
        document.getElementById('jwplayerContainer').style.display = 'none';
        document.getElementById('shakaContainer').style.display = 'block';
        
        const video = document.getElementById('shakaVideo');
        const container = document.getElementById('shakaVideoContainer');
        
        // Clean up previous player
        if (shakaPlayer) {
          try {
            shakaPlayer.destroy();
          } catch (e) {}
          shakaPlayer = null;
        }
        
        if (shakaUI) {
          try {
            shakaUI.destroy();
          } catch (e) {}
          shakaUI = null;
        }
        
        // Initialize Shaka
        await initShakaPlayer();
        
        // Create new player
        shakaPlayer = new shaka.Player(video);
        
        // Configure player - HIDE ALL SPINNERS
        const config = {
          streaming: {
            bufferingGoal: 30,
            rebufferingGoal: 2
          },
          ui: {
            addSeekBar: true,
            controlPanelElements: [
              'play_pause',
              'mute',
              'volume',
              'time_and_duration',
              'fullscreen',
              'overflow_menu'
            ]
          }
        };
        
        // Add DRM keys if available
        if (channel.keys && Object.keys(channel.keys).length > 0) {
          config.drm = {
            clearKeys: channel.keys
          };
        }
          </script>
</body>
</html>
